

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration &mdash; symfony-docs-fr v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-fr v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Object Relational Mapper" href="index.html" />
    <link rel="next" title="Console Commands" href="console.html" />
    <link rel="prev" title="ORM" href="overview.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="console.html" title="Console Commands"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="ORM"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">symfony-docs-fr v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Manuel</a> &raquo;</li>
          <li><a href="../index.html" >Doctrine</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Object Relational Mapper</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuration">
<span id="index-0"></span><h1>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h1>
<p>In the overview we already described the only necessary configuration option
&#8220;mappings&#8221; to get the Doctrine ORM running with Symfony 2. All the other
configuration options are used with reasonable default values.</p>
<p>This following configuration example shows all the configuration defaults that
the ORM resolves to:</p>
<div class="highlight-yaml"><pre>doctrine:
    orm:
        mappings:
            HelloBundle: ~
        auto_generate_proxy_classes: true
        proxy_namespace: Proxies
        proxy_dir: %kernel.cache_dir%/doctrine/orm/Proxies
        default_entity_manager: default
        default_connection: default
        metadata_cache_driver: array
        query_cache_driver: array
        result_cache_driver: array</pre>
</div>
<p>There are lots of other configuration options that you can use to overwrite
certain classes, but those are for very advanced use-cases only. You should
look at the &#8220;orm.xml&#8221; file in the DoctrineBundle to get an overview of all the
supported options.</p>
<p>For the caching drivers you can specifiy the values &#8220;array&#8221;, &#8220;apc&#8221;, &#8220;memcache&#8221;
or &#8220;xcache&#8221;.</p>
<p>The following example shows an overview of the caching configurations:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">doctrine</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">orm</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">mappings</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">HelloBundle</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
        <span class="l-Scalar-Plain">metadata_cache_driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">apc</span>
        <span class="l-Scalar-Plain">query_cache_driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">xcache</span>
        <span class="l-Scalar-Plain">result_cache_driver</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">memcache</span>
            <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">localhost</span>
            <span class="l-Scalar-Plain">port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">11211</span>
            <span class="l-Scalar-Plain">instance_class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Memcache</span>
</pre></div>
</div>
<div class="section" id="mapping-configuration">
<h2>Mapping Configuration<a class="headerlink" href="#mapping-configuration" title="Permalink to this headline">¶</a></h2>
<p>Explicit definition of all the mapped entities is the only necessary
configuration for the ORM and there are several configuration options that you
can control. The following configuration options exist for a mapping:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">type</span></tt> One of &#8220;annotation&#8221;, &#8220;xml&#8221;, &#8220;yml&#8221;, &#8220;php&#8221; or &#8220;static-php&#8221;. This
specifies which type of metadata type your mapping uses.</li>
<li><tt class="docutils literal"><span class="pre">dir</span></tt> Path to the mapping or entity files (depending on the driver). If
this path is relative it is assumed to be relative to the bundle root. This
only works if the name of your mapping is a bundle name. If you want to use
this option to specifiy absolute paths you should prefix the path with the
kernel parameters that exist in the DIC (for example %kernel.dir%).</li>
<li><tt class="docutils literal"><span class="pre">prefix</span></tt> A common namespace prefix that all entities of this mapping
share. This prefix should never conflict with prefixes of other defined
mappings otherwise some of your entities cannot be found by Doctrine. This
option defaults to the bundle namespace + <tt class="docutils literal"><span class="pre">Entity</span></tt>, for example for an
application bundle called &#8220;Hello&#8221; prefix would be
<tt class="docutils literal"><span class="pre">Sensio\Hello\Entity</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">alias</span></tt> Doctrine offers a way to alias entity namespaces to simpler,
shorter names to be used in DQL queries or for Repository access.</li>
<li><tt class="docutils literal"><span class="pre">is_bundle</span></tt> This option is a derived value from <tt class="docutils literal"><span class="pre">dir</span></tt> and by default is
set to true if dir is relative proved by a <tt class="docutils literal"><span class="pre">file_exists()</span></tt> check that
returns false. It is false if the existence check returns true. In this case
an absolute path was specified and the metadata files are most likely in a
directory outside of a bundle.</li>
</ul>
<p>To avoid having to configure lots of information for your mappings you should
follow these conventions:</p>
<ol class="arabic simple">
<li>Put all your entities in a directory <tt class="docutils literal"><span class="pre">Entity/</span></tt> inside your bundle. For
example <tt class="docutils literal"><span class="pre">Sensio/Hello/Entity/</span></tt>.</li>
<li>If you are using xml, yml or php mapping put all your configuration files
into the &#8220;Resources/config/doctrine/metadata/doctrine/orm/&#8221; directory sufficed
with dcm.xml, dcm.yml or dcm.php respectively.</li>
<li>Annotations is assumed if an <tt class="docutils literal"><span class="pre">Entity/</span></tt> but no
&#8220;Resources/config/doctrine/metadata/doctrine/orm/&#8221; directory is found.</li>
</ol>
<p>The following configuration shows a bunch of mapping examples:</p>
<div class="highlight-yaml"><pre>doctrine:
    orm:
        mappings:
            MyBundle1: ~
            MyBundle2: yml
            MyBundle3: { type: annotation, dir: Entity/ }
            MyBundle4: { type: xml, dir: Resources/config/doctrine/mapping }
            MyBundle5:
                type: yml
                dir: my-bundle-mappings-dir
                alias: BundleAlias
            doctrine_extensions:
                type: xml
                dir: %kernel.dir%/../src/vendor/DoctrineExtensions/lib/DoctrineExtensions/Entity
                prefix: DoctrineExtensions\Entity\
                alias: DExt</pre>
</div>
</div>
<div class="section" id="registering-event-listeners-and-subscribers">
<h2>Registering Event Listeners and Subscribers<a class="headerlink" href="#registering-event-listeners-and-subscribers" title="Permalink to this headline">¶</a></h2>
<p>Doctrine uses the lightweight <tt class="docutils literal"><span class="pre">Doctrine\Common\EventManager</span></tt> class to trigger
a number of different events which you can hook into. You can register Event
Listeners or Subscribers by tagging the respective services with
<tt class="docutils literal"><span class="pre">doctrine.dbal.&lt;connection&gt;_event_listener</span></tt> or
<tt class="docutils literal"><span class="pre">doctrine.dbal.&lt;connection&gt;_event_subscriber</span></tt> using the Dependency Injenction
container.</p>
<p>You have to use the name of the DBAL connection to clearly identify which
connection the listeners should be registered with. If you are using multiple
connections you can hook different events into each connection.</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.symfony-project.org/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.symfony-project.org/schema/dic/services http://www.symfony-project.org/schema/dic/services/services-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;services&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;doctrine.extensions.versionable_listener&quot;</span> <span class="na">class=</span><span class="s">&quot;DoctrineExtensions\Versionable\VersionableListener&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;doctrine.dbal.default_event_subscriber&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>

        <span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;mybundle.doctrine.mylistener&quot;</span> <span class="na">class=</span><span class="s">&quot;MyBundle\Doctrine\MyListener&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;doctrine.dbal.default_event_listener&quot;</span> <span class="na">event=</span><span class="s">&quot;prePersist&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/service&gt;</span>

    <span class="nt">&lt;/services&gt;</span>

<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
<p>Although the Event Listener and Subscriber tags are prefixed with <tt class="docutils literal"><span class="pre">doctrine.dbal</span></tt>
these tags also work for the ORM events. Internally Doctrine re-uses the EventManager
that is registered with the connection for the ORM.</p>
</div>
<div class="section" id="multiple-entity-managers">
<h2>Multiple Entity Managers<a class="headerlink" href="#multiple-entity-managers" title="Permalink to this headline">¶</a></h2>
<p>You can use multiple EntityManagers in a Symfony application. This is
necessary if you are using different databases or even vendors with entirely
different sets of entities.</p>
<p>The following configuration code shows how to define two EntityManagers:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">doctrine</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">orm</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">default_entity_manager</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">default</span>
        <span class="l-Scalar-Plain">cache_driver</span><span class="p-Indicator">:</span>             <span class="l-Scalar-Plain">apc</span>           <span class="c1"># array, apc, memcache, xcache</span>
        <span class="l-Scalar-Plain">entity_managers</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">connection</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">default</span>
                <span class="l-Scalar-Plain">mappings</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">MyBundle1</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
                    <span class="l-Scalar-Plain">MyBundle2</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="l-Scalar-Plain">customer</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">connection</span><span class="p-Indicator">:</span>       <span class="l-Scalar-Plain">customer</span>
                <span class="l-Scalar-Plain">mappings</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">MyBundle3</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
<p>Just like the DBAL, if you have configured multiple <tt class="docutils literal"><span class="pre">EntityManager</span></tt>
instances and want to get a specific one you can use the full service name to
retrieve it from the Symfony Dependency Injection Container:</p>
<div class="highlight-python"><pre>class UserController extends Controller
{
    public function indexAction()
    {
        $em =  $this-&gt;get('doctrine.orm.entity_manager');
        $defaultEm =  $this-&gt;get('doctrine.orm.default_entity_manager');
        $customerEm = $this-&gt;get('doctrine.orm.customer_entity_manager');

        // $em === $defaultEm =&gt; true
        // $defaultEm === $customerEm =&gt; false
    }
}</pre>
</div>
<p>The service &#8220;doctrine.orm.entity_manager&#8221; is an alias for the default entity
manager defined in the &#8220;default_entity_manager&#8221; configuration option.</p>
</div>
<div class="section" id="doctrine-event-config">
<span id="id1"></span><h2>Registering Event Listeners and Subscribers<a class="headerlink" href="#doctrine-event-config" title="Permalink to this headline">¶</a></h2>
<p>Doctrine ships with an event system that allows to hook into many different
events happening during the lifecycle of entities or at other occasions.</p>
<p>To register services to act as event listeners or subscribers (listeners from here)
you have to tag them with the appropriate names. Depending on your use-case you can hook
a listener into every DBAL Connection and ORM Entity Manager or just into one
specific DBAL connection and all the EntityManagers that use this connection.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuration</a><ul>
<li><a class="reference internal" href="#mapping-configuration">Mapping Configuration</a></li>
<li><a class="reference internal" href="#registering-event-listeners-and-subscribers">Registering Event Listeners and Subscribers</a></li>
<li><a class="reference internal" href="#multiple-entity-managers">Multiple Entity Managers</a></li>
<li><a class="reference internal" href="#doctrine-event-config">Registering Event Listeners and Subscribers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">ORM</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="console.html"
                        title="next chapter">Console Commands</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/book/doctrine/orm/configuration.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="console.html" title="Console Commands"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="ORM"
             >previous</a> |</li>
        <li><a href="../../../index.html">symfony-docs-fr v0.1 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Manuel</a> &raquo;</li>
          <li><a href="../index.html" >Doctrine</a> &raquo;</li>
          <li><a href="index.html" >Object Relational Mapper</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>