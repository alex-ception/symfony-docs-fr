

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The Controller &mdash; symfony-docs-fr v0.1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-fr v0.1 documentation" href="../index.html" />
    <link rel="up" title="Manuel" href="index.html" />
    <link rel="next" title="Routing" href="routing.html" />
    <link rel="prev" title="Configuration" href="doctrine/mongodb-odm/configuration.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="doctrine/mongodb-odm/configuration.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">symfony-docs-fr v0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Manuel</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="the-controller">
<span id="index-0"></span><h1>The Controller<a class="headerlink" href="#the-controller" title="Permalink to this headline">¶</a></h1>
<p>A controller is a PHP function you create that takes information from the
HTTP request and constructs and returns an HTTP response (as a Symfony2
<tt class="docutils literal"><span class="pre">Response</span></tt> object). The response could be an HTML page, an XML document,
a serialized JSON array, an image, a redirect, a 404 error or anything else
you can dream up. The controller contains whatever arbitrary logic <em>your
application</em> needs to create that response.</p>
<p>Along the way, your controller might read information from the request, load
a database resource, send an email, or set information on the user&#8217;s session.
But in all cases, the controller&#8217;s final job is to return the <tt class="docutils literal"><span class="pre">Response</span></tt>
object that will be delivered back to the client. There&#8217;s no magic and no
other requirements to worry about. Here are a few common examples:</p>
<ul class="simple">
<li><em>Controller A</em> prepares a <tt class="docutils literal"><span class="pre">Response</span></tt> object representing the content
for the homepage of the site.</li>
<li><em>Controller B</em> reads the <tt class="docutils literal"><span class="pre">slug</span></tt> parameter from the request to load a
blog entry from the database and create a <tt class="docutils literal"><span class="pre">Response</span></tt> object displaying
that blog. If the <tt class="docutils literal"><span class="pre">slug</span></tt> can&#8217;t be found in the database, it creates and
returns a <tt class="docutils literal"><span class="pre">Response</span></tt> object with a 404 status code.</li>
<li><em>Controller C</em> handles the form submission of a contact form. It reads
the form information from the request, saves the contact information to
the database and emails the contact information to the webmaster. Finally,
it creates a <tt class="docutils literal"><span class="pre">Response</span></tt> object that redirects the client&#8217;s browser to
the contact form &#8220;thank you&#8221; page.</li>
</ul>
<div class="section" id="requests-controller-response-lifecycle">
<span id="index-1"></span><h2>Requests, Controller, Response Lifecycle<a class="headerlink" href="#requests-controller-response-lifecycle" title="Permalink to this headline">¶</a></h2>
<p>Every request handled by a Symfony2 project goes through the same basic lifecycle.
The framework takes care of the repetitive tasks and ultimately executes a
controller, which houses your custom application code:</p>
<ul class="simple">
<li>Each request is handled by a single front controller file (e.g. <tt class="docutils literal"><span class="pre">app.php</span></tt>
or <tt class="docutils literal"><span class="pre">index.php</span></tt>) that&#8217;s responsible for bootstrapping the framework;</li>
<li>The <tt class="docutils literal"><span class="pre">Router</span></tt> reads the request information, matches that information to
a specific route, and determines from that route which controller should
be called;</li>
<li>The controller is executed and the code inside the controller creates and
returns a <tt class="docutils literal"><span class="pre">Response</span></tt> object;</li>
<li>The HTTP headers and content of the <tt class="docutils literal"><span class="pre">Response</span></tt> object are sent back to
the client.</li>
</ul>
<p>Creating a page is as easy as creating a controller and making a route that
maps a URI to that controller.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Though similarly named, a &#8220;front controller&#8221; is different from the
&#8220;controllers&#8221; we&#8217;ll talk about in this chapter. A front controller
is a short PHP file that lives in your web directory and through which
all requests are directed. A typical application will have a production
front controller (e.g. <tt class="docutils literal"><span class="pre">app.php</span></tt>) and a development front controller
(e.g. <tt class="docutils literal"><span class="pre">app_dev.php</span></tt>). You&#8217;ll likely never need to edit, view or worry
about the front controllers in your application.</p>
</div>
</div>
<div class="section" id="a-simple-controller">
<span id="index-2"></span><h2>A Simple Controller<a class="headerlink" href="#a-simple-controller" title="Permalink to this headline">¶</a></h2>
<p>The controller is a PHP callable responsible for returning a representation
of the resource (most of the time an HTML representation). Though a controller
can be any PHP callable (a function, a method on an object, or a <tt class="docutils literal"><span class="pre">Closure</span></tt>),
in Symfony2, a controller is usually a single method inside a controller
object. Controllers are also called <em>actions</em>.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Sensio/HelloBundle/Controller/HelloController.php</span>

<span class="x">namespace Sensio\HelloBundle\Controller;</span>
<span class="x">use Symfony\Component\HttpFoundation\Response;</span>

<span class="x">class HelloController</span>
<span class="x">{</span>
<span class="x">    public function indexAction($name)</span>
<span class="x">    {</span>
<span class="x">      return new Response(&#39;&lt;html&gt;&lt;body&gt;Hello &#39;.$name.&#39;!&lt;/body&gt;&lt;/html&gt;&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Note that the <em>controller</em> is the <tt class="docutils literal"><span class="pre">indexAction</span></tt> method, which lives
inside a <em>controller class</em> (<tt class="docutils literal"><span class="pre">HelloController</span></tt>). Don&#8217;t be confused
by the naming: a <em>controller class</em> is simply a convenient way to group
several controllers together. Typically, the controller class will house
several controllers (e.g. <tt class="docutils literal"><span class="pre">updateAction</span></tt>, <tt class="docutils literal"><span class="pre">deleteAction</span></tt>, etc). A
controller is also sometimes referred to as an <em>action</em>.</p>
</div>
<p>This controller is pretty straightforward, but let&#8217;s walk through it:</p>
<ul class="simple">
<li><em>line 3</em>: Symfony2 takes advantage of PHP 5.3 namespace functionality to
namespace the entire controller class. The <tt class="docutils literal"><span class="pre">use</span></tt> keyword imports the
<tt class="docutils literal"><span class="pre">Response</span></tt> class, which our controller must return.</li>
<li><em>line 6</em>: The class name is the concatenation of a name for the controller
class and the word <tt class="docutils literal"><span class="pre">Controller</span></tt>. This is a convention that provides consistency
to controllers and allows them to be referenced only by the first part of
the name (i.e. <tt class="docutils literal"><span class="pre">Hello</span></tt>) in the routing configuration.</li>
<li><em>line 8</em>: Each action in a controller class is suffixed with <tt class="docutils literal"><span class="pre">Action</span></tt>
and is referenced in the routing configuration by the action&#8217;s name (<tt class="docutils literal"><span class="pre">index</span></tt>).
In the next section, we&#8217;ll use a route to map a URI to this action and
show how the route&#8217;s placeholders (<tt class="docutils literal"><span class="pre">{name}</span></tt>) become arguments on the
action (<tt class="docutils literal"><span class="pre">$name</span></tt>).</li>
<li><em>line 10</em>: The controller creates and returns a <tt class="docutils literal"><span class="pre">Response</span></tt> object.</li>
</ul>
</div>
<div class="section" id="mapping-a-uri-to-a-controller">
<span id="index-3"></span><h2>Mapping a URI to a Controller<a class="headerlink" href="#mapping-a-uri-to-a-controller" title="Permalink to this headline">¶</a></h2>
<p>Our new controller returns a simple HTML page. To render this controller
at a specific URL, we need to create a route to it.</p>
<p>We&#8217;ll talk about the <tt class="docutils literal"><span class="pre">Routing</span></tt> component in detail in the <a class="reference internal" href="routing.html"><em>Routing chapter</em></a>,
but let&#8217;s create a simple route to our controller:</p>
<p>Going to <tt class="docutils literal"><span class="pre">/hello/ryan</span></tt> now executes the <tt class="docutils literal"><span class="pre">HelloController::indexAction()</span></tt>
controller and passes in <tt class="docutils literal"><span class="pre">ryan</span></tt> for the <tt class="docutils literal"><span class="pre">$name</span></tt> variable. Creating a
&#8220;page&#8221; means simply creating a controller method and associated route. There&#8217;s
no hidden layers or behind-the-scenes magic.</p>
<p>Notice the syntax used to refer to the controller: <tt class="docutils literal"><span class="pre">HelloBundle:Hello:index</span></tt>.
Symfony2 uses a flexible string notation to refer to different controllers.
This is the most common syntax and tells Symfony2 to look for a controller
class called <tt class="docutils literal"><span class="pre">HelloController</span></tt> inside a bundle named <tt class="docutils literal"><span class="pre">HelloBundle</span></tt>. The
method <tt class="docutils literal"><span class="pre">indexAction()</span></tt> is then executed.</p>
<p>For more details on the string format used to reference different controllers,
see <a class="reference internal" href="routing.html#controller-string-syntax"><em>Controller Naming Format</em></a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Notice that since our controller lives in the <tt class="docutils literal"><span class="pre">HelloBundle</span></tt>, we&#8217;ve
placed the routing configuration inside the <tt class="docutils literal"><span class="pre">HelloBundle</span></tt> to stay
organized. To load routing configuration that lives inside a bundle, it
must be imported from your application&#8217;s main routing resource. See
<em class="xref std std-ref">routing-include-external-resources</em> for more information.</p>
</div>
<div class="section" id="route-parameters-as-controller-arguments">
<span id="route-parameters-controller-arguments"></span><span id="index-4"></span><h3>Route Parameters as Controller Arguments<a class="headerlink" href="#route-parameters-as-controller-arguments" title="Permalink to this headline">¶</a></h3>
<p>We already know now that the <tt class="docutils literal"><span class="pre">_controller</span></tt> parameter <tt class="docutils literal"><span class="pre">HelloBundle:Hello:index</span></tt>
refers to a <tt class="docutils literal"><span class="pre">HelloController::indexAction()</span></tt> method that lives inside the
<tt class="docutils literal"><span class="pre">HelloBundle</span></tt> bundle. What&#8217;s more interesting is the arguments that are
passed to that method:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/Sensio/HelloBundle/Controller/HelloController.php</span>

<span class="k">namespace</span> <span class="nx">Sensio\HelloBundle\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">indexAction</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The controller has a single argument, <tt class="docutils literal"><span class="pre">$name</span></tt>, which corresponds to the
<tt class="docutils literal"><span class="pre">{name}</span></tt> parameter from the matched route (<tt class="docutils literal"><span class="pre">ryan</span></tt> in our example). In
fact, when executing your controller, Symfony2 matches each argument of
the controller with a parameter from the matched route. Take the following
example:</p>
<p>The controller for this can take several arguments:</p>
<div class="highlight-python"><pre>public function indexAction($first_name, $last_name, $color)
{
    // ...
}</pre>
</div>
<p>Notice that both placeholder variables (<tt class="docutils literal"><span class="pre">{{first_name}}</span></tt>, <tt class="docutils literal"><span class="pre">{{last_name}}</span></tt>)
as well as the default <tt class="docutils literal"><span class="pre">color</span></tt> variable are available as arguments in the
controller. When a route is matched, the placeholder variables are merged
with the <tt class="docutils literal"><span class="pre">defaults</span></tt> to make one array that&#8217;s available to your controller.</p>
<p>Mapping route parameters to controller arguments is easy and flexible. Keep
the following guidelines in mind while you develop.</p>
<div class="section" id="the-order-of-the-controller-arguments-does-not-matter">
<h4>The order of the controller arguments does not matter.<a class="headerlink" href="#the-order-of-the-controller-arguments-does-not-matter" title="Permalink to this headline">¶</a></h4>
<p>Symfony2 is able to matches the parameter names from the route to the variable
names in the controller method&#8217;s signature. In other words, it realizes that
the <tt class="docutils literal"><span class="pre">last_name</span></tt> parameter matches up with the <tt class="docutils literal"><span class="pre">$last_name</span></tt> argument.
The arguments of the controller could be totally reordered and still work
perfectly:</p>
<div class="highlight-python"><pre>public function indexAction($last_name, $color, $first_name)
{
    // ..
}</pre>
</div>
</div>
<div class="section" id="each-required-controller-argument-must-match-up-with-a-routing-parameter">
<h4>Each required controller argument must match up with a routing parameter.<a class="headerlink" href="#each-required-controller-argument-must-match-up-with-a-routing-parameter" title="Permalink to this headline">¶</a></h4>
<p>The following would throw a <tt class="docutils literal"><span class="pre">RuntimeException</span></tt> because there is no <tt class="docutils literal"><span class="pre">foo</span></tt>
parameter defined in the route:</p>
<div class="highlight-python"><pre>public function indexAction($first_name, $last_name, $color, $foo)
{
    // ..
}</pre>
</div>
<p>Making the argument optional, however, is perfectly ok. The following
example would not throw an exception:</p>
<div class="highlight-python"><pre>public function indexAction($first_name, $last_name, $color, $foo = 'bar')
{
    // ..
}</pre>
</div>
</div>
<div class="section" id="not-all-routing-parameters-need-to-be-arguments-on-your-controller">
<h4>Not all routing parameters need to be arguments on your controller.<a class="headerlink" href="#not-all-routing-parameters-need-to-be-arguments-on-your-controller" title="Permalink to this headline">¶</a></h4>
<p>If, for example, the <tt class="docutils literal"><span class="pre">last_name</span></tt> weren&#8217;t important for your controller,
you could omit it entirely:</p>
<div class="highlight-python"><pre>public function indexAction($first_name, $color)
{
    // ..
}</pre>
</div>
<p>In fact, the <tt class="docutils literal"><span class="pre">_controller</span></tt> route parameter itself is technically available
as a controller argument since it&#8217;s in the <tt class="docutils literal"><span class="pre">defaults</span></tt> of the route. Of
course, it&#8217;s generally not very useful, so it&#8217;s omitted from our controller.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Every route also has a special <tt class="docutils literal"><span class="pre">_route</span></tt> parameter, which is equal to
the name of the route that was matched (e.g. <tt class="docutils literal"><span class="pre">hello</span></tt>). Though not usually
useful, this is equally available as a controller argument.</p>
</div>
</div>
</div>
</div>
<div class="section" id="the-base-controller-class">
<h2>The Base Controller Class<a class="headerlink" href="#the-base-controller-class" title="Permalink to this headline">¶</a></h2>
<p>For convenience, Symfony2 comes with a base <tt class="docutils literal"><span class="pre">Controller</span></tt> class that assists
with some of the most common controller tasks and gives your controller class
access to any resource it might need. By extending this <tt class="docutils literal"><span class="pre">Controller</span></tt> class,
you can take advantage of several helper methods.</p>
<p>Add the <tt class="docutils literal"><span class="pre">use</span></tt> statement atop the <tt class="docutils literal"><span class="pre">Controller</span></tt> class and then modify the
<tt class="docutils literal"><span class="pre">HelloController</span></tt> to extend it. That&#8217;s all there is to it.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Sensio/HelloBundle/Controller/HelloController.php</span>

<span class="x">namespace Sensio\HelloBundle\Controller;</span>
<span class="x">use Symfony\Bundle\FrameworkBundle\Controller\Controller;</span>
<span class="x">use Symfony\Component\HttpFoundation\Response;</span>

<span class="x">class HelloController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function indexAction($name)</span>
<span class="x">    {</span>
<span class="x">      return new Response(&#39;&lt;html&gt;&lt;body&gt;Hello &#39;.$name.&#39;!&lt;/body&gt;&lt;/html&gt;&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<p>So far, extending the base <tt class="docutils literal"><span class="pre">Controller</span></tt> class hasn&#8217;t changed anything. In
the next section, we&#8217;ll walk through several helper methods that the base
controller class makes available. These methods are just shortcuts to using
core Symfony2 functionality that&#8217;s available to you with or without the use of
the base <tt class="docutils literal"><span class="pre">Controller</span></tt> class. A great way to see the core functionality in
action is to look in the
<tt class="xref py py-class docutils literal"><span class="pre">Symfony\Bundle\FrameworkBundle\Controller\Controller</span></tt> class
itself.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Extending the base class is a <em>choice</em> in Symfony; it contains useful
shortcuts but nothing mandatory. You can also extend
<tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\DependencyInjection\ContainerAware</span></tt>. The
service container object will then be accessible via the <tt class="docutils literal"><span class="pre">container</span></tt>
property and this is the only object you need to create any controller.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can also define your <a class="reference internal" href="../cookbook/controller/service.html"><em>Controllers as Services</em></a>.</p>
</div>
</div>
<div class="section" id="common-controller-tasks">
<span id="index-5"></span><h2>Common Controller Tasks<a class="headerlink" href="#common-controller-tasks" title="Permalink to this headline">¶</a></h2>
<p>Though a controller can do virtually anything, most controllers will perform
the same basic tasks over and over again. These tasks, such as redirecting,
forwarding, rendering templates and accessing core services, are very easy
to manage in Symfony2.</p>
<div class="section" id="redirecting">
<span id="index-6"></span><h3>Redirecting<a class="headerlink" href="#redirecting" title="Permalink to this headline">¶</a></h3>
<p>If you want to redirect the user to another page, use a special <tt class="docutils literal"><span class="pre">RedirectResponse</span></tt>
class, which is designed specifically to redirect the user to another URL:</p>
<div class="highlight-python"><pre>// ...
use Symfony\Component\HttpFoundation\RedirectResponse;

class HelloController extends Controller
{
  public function indexAction()
  {
      return new RedirectResponse($this-&gt;generateUrl('hello', array('name' =&gt; 'Lucas')));
  }
}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">generateUrl()</span></tt> method is just a shortcut that calls <tt class="docutils literal"><span class="pre">generate()</span></tt>
on the <tt class="docutils literal"><span class="pre">router</span></tt> service. It takes the route name and an array of parameters
as arguments and returns the associated friendly URL. See the <a class="reference internal" href="routing.html"><em>Routing</em></a>
chapter for more information.</p>
<p>By default, the <tt class="docutils literal"><span class="pre">redirect</span></tt> method does a 302 (temporary) redirect. To perform
a 301 (permanent) redirect, modify the second argument:</p>
<div class="highlight-python"><pre>public function indexAction()
{
    return new RedirectResponse($this-&gt;generateUrl('hello', array('name' =&gt; 'Lucas')), 301);
}</pre>
</div>
</div>
<div class="section" id="forwarding">
<span id="index-7"></span><h3>Forwarding<a class="headerlink" href="#forwarding" title="Permalink to this headline">¶</a></h3>
<p>You can also easily forward to another action internally with the <tt class="docutils literal"><span class="pre">forward()</span></tt>
method. Instead of redirecting the user&#8217;s browser, it makes an internal sub-request,
and calls the specified controller. The <tt class="docutils literal"><span class="pre">forward()</span></tt> method returns the <tt class="docutils literal"><span class="pre">Response</span></tt>
object to allow for further modification if the need arises. That <tt class="docutils literal"><span class="pre">Response</span></tt>
object is the end-product of the internal sub-request:</p>
<div class="highlight-python"><pre>public function indexAction($name)
{
    $response = $this-&gt;forward('HelloBundle:Hello:fancy', array(
        'name'  =&gt; $name,
        'color' =&gt; 'green'
    ));

    // further modify the response or return it directly

    return $response;
}</pre>
</div>
<p>Notice that the <cite>forward()</cite> method uses the same string representation of
the controller used in the routing configuration. The array passed to the
method becomes the arguments on the resulting controller. This same interface
is used when embedding controllers into templates (see <a class="reference internal" href="templating.html#templating-embedding-controller"><em>Embedding Controllers</em></a>).
The target controller method should look something like the following:</p>
<div class="highlight-python"><pre>public function fancyAction($name, $green)
{
    // ... create and return a Response object
}</pre>
</div>
<p>And just like when creating a controller for a route, the order of the arguments
to <tt class="docutils literal"><span class="pre">fancyAction</span></tt> doesn&#8217;t matter. Symfony2 matches the index key names
(e.g. <tt class="docutils literal"><span class="pre">name</span></tt>) with the method argument names (e.g. <tt class="docutils literal"><span class="pre">$name</span></tt>). If you
change the order of the arguments, Symfony2 will still pass the correct
value to each variable.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>Like other base <tt class="docutils literal"><span class="pre">Controller</span></tt> methods, the <tt class="docutils literal"><span class="pre">forward</span></tt> method is just
a shortcut for core Symfony2 functionality. A forward can be accomplished
directly via the <tt class="docutils literal"><span class="pre">http_kernel</span></tt> service. A forward returns a <tt class="docutils literal"><span class="pre">Response</span></tt>
object:</p>
<div class="last highlight-python"><pre>$httpKernel = $this-&gt;container-&gt;get('http_kernel');
$response = $httpKernel-&gt;forward('HelloBundle:Hello:fancy', array(
    'name'  =&gt; $name,
    'color' =&gt; 'green',
));</pre>
</div>
</div>
</div>
<div class="section" id="rendering-templates">
<span id="index-8"></span><h3>Rendering Templates<a class="headerlink" href="#rendering-templates" title="Permalink to this headline">¶</a></h3>
<p>Though not a requirement, most controllers will ultimately render a template
that&#8217;s responsible for generating the HTML (or other format) for the controller.
The <tt class="docutils literal"><span class="pre">renderView()</span></tt> method renders a template and returns its content. The
content from the template can be used to create a <tt class="docutils literal"><span class="pre">Response</span></tt> object:</p>
<div class="highlight-python"><pre>$content = $this-&gt;renderView('HelloBundle:Hello:index.html.twig', array('name' =&gt; $name));

return new Response($content);</pre>
</div>
<p>This can even be done in just one step with the <tt class="docutils literal"><span class="pre">render()</span></tt> method, which
returns a <tt class="docutils literal"><span class="pre">Response</span></tt> object with the content from the template:</p>
<div class="highlight-python"><pre>return $this-&gt;render('HelloBundle:Hello:index.html.twig', array('name' =&gt; $name));</pre>
</div>
<p>The Symfony templating engine is explained in great detail in the <a class="reference internal" href="templating.html"><em>Templating</em></a>
chapter.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The <tt class="docutils literal"><span class="pre">renderView</span></tt> method is a shortcut to direct use of the <tt class="docutils literal"><span class="pre">templating</span></tt>
service. The <tt class="docutils literal"><span class="pre">templating</span></tt> service can also be used directly:</p>
<div class="last highlight-python"><pre>$templating = $this-&gt;get('templating');
$content = $templating-&gt;render('HelloBundle:Hello:index.html.twig', array('name' =&gt; $name));</pre>
</div>
</div>
</div>
<div class="section" id="accessing-other-services">
<span id="index-9"></span><h3>Accessing other Services<a class="headerlink" href="#accessing-other-services" title="Permalink to this headline">¶</a></h3>
<p>When extending the base controller class, you can access any Symfony2 service
via the <tt class="docutils literal"><span class="pre">get()</span></tt> method. Here are several common services you might need:</p>
<div class="highlight-python"><pre>$request = $this-&gt;get('request');

$response = $this-&gt;get('response');

$templating = $this-&gt;get('templating');

$router = $this-&gt;get('router');

$mailer = $this-&gt;get('mailer');</pre>
</div>
<p>The are countless other services available and you are encouraged to define
your own. For more information, see the <tt class="xref doc docutils literal"><span class="pre">Extending</span> <span class="pre">Symfony</span></tt>
chapter.</p>
</div>
</div>
<div class="section" id="managing-errors">
<span id="index-10"></span><h2>Managing Errors<a class="headerlink" href="#managing-errors" title="Permalink to this headline">¶</a></h2>
<p>When things are not found, you should play well with the HTTP protocol and
return a 404 response. This is easily done by throwing a built-in HTTP
exception:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;</span>

<span class="x">public function indexAction()</span>
<span class="x">{</span>
<span class="x">    $product = // retrieve the object from database</span>
<span class="x">    if (!$product) {</span>
<span class="x">        throw new NotFoundHttpException(&#39;The product does not exist.&#39;);</span>
<span class="x">    }</span>

<span class="x">    return $this-&gt;render(...);</span>
<span class="x">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">NotFoundHttpException</span></tt> will return a 404 HTTP response back to the
browser. When viewing a page in debug mode, a full exception with stacktrace
is displayed so that the cause of the exception can be easily tracked down.</p>
<p>Of course, you&#8217;re free to throw any <tt class="docutils literal"><span class="pre">Exception</span></tt> class in your controller
- Symfony2 will automatically return a 500 HTTP response code.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">throw new \Exception(&#39;Something went wrong!&#39;);</span>
</pre></div>
</div>
<p>In every case, a styled error page is shown to the end user and a full debug
error page is shown to the developer (when viewing the page in debug mode).
Both of these error pages can be customized.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Read the &#8220;<a class="reference internal" href="../cookbook/controller/error_pages.html"><em>How to customize Error Pages</em></a>&#8221; recipe to learn more.</p>
</div>
</div>
<div class="section" id="managing-the-session">
<span id="index-11"></span><h2>Managing the Session<a class="headerlink" href="#managing-the-session" title="Permalink to this headline">¶</a></h2>
<p>Even if the HTTP protocol is stateless, Symfony2 provides a nice session object
that represents the client (be it a real person using a browser, a bot, or a
web service). Between two requests, Symfony2 stores the attributes in a cookie
by using the native PHP sessions.</p>
<p>Storing and retrieving information from the session can be easily achieved
from any controller:</p>
<div class="highlight-python"><pre>$session = $this-&gt;get('request')-&gt;getSession();

// store an attribute for reuse during a later user request
$session-&gt;set('foo', 'bar');

// in another controller for another request
$foo = $session-&gt;get('foo');

// set the user locale
$session-&gt;setLocale('fr');</pre>
</div>
<p>These attributes will remain on the user for the remainder of that user&#8217;s
session.</p>
<div class="section" id="flash-messages">
<span id="index-12"></span><h3>Flash Messages<a class="headerlink" href="#flash-messages" title="Permalink to this headline">¶</a></h3>
<p>You can also store small messages that will be stored on the user&#8217;s session
for exactly one additional request. This is useful when processing a form:
you want to redirect and have a special message shown on the <em>next</em> request.
These types of messages are called &#8220;flash&#8221; messages.</p>
<p>Let&#8217;s show an example where we&#8217;re processing a form submit:</p>
<div class="highlight-python"><pre>public function updateAction()
{
    if ('POST' === $this-&gt;get('request')-&gt;getMethod()) {
        // do some sort of processing

        $this-&gt;get('session')-&gt;setFlash('notice', 'Your changes were saved!');

        return new RedirectResponse($this-&gt;generateUrl(...));
    }

    return $this-&gt;render(...);
}</pre>
</div>
<p>After processing the request, the controller sets a <tt class="docutils literal"><span class="pre">notice</span></tt> flash message
and then redirects. In the template of the next action, the following code
could be used to render the message:</p>
<p>By design, flash messages are meant to only live for exactly one request
(they&#8217;re &#8220;gone in a flash&#8221;). They&#8217;re designed to be used across redirects
exactly as we&#8217;ve done in this example.</p>
</div>
</div>
<div class="section" id="the-response-object">
<span id="index-13"></span><h2>The Response Object<a class="headerlink" href="#the-response-object" title="Permalink to this headline">¶</a></h2>
<p>The only requirement for a controller is to return a <tt class="docutils literal"><span class="pre">Response</span></tt> object. The
<tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\Response</span></tt> class is a PHP
abstraction around the HTTP response - the text-based message filled with HTTP
headers and content that&#8217;s sent back to the client:</p>
<div class="highlight-python"><pre>// create a simple Response with a 200 status code (the default)
$response = new Response('Hello '.$name, 200);

// create a JSON-response with a 200 status code
$response = new Response(json_encode(array('name' =&gt; $name)));
$response-&gt;headers-&gt;set('Content-Type', 'application/json');</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The <tt class="docutils literal"><span class="pre">headers</span></tt> property is a
<tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\HeaderBag</span></tt> object with several
useful methods for reading and mutating the <tt class="docutils literal"><span class="pre">Response</span></tt> headers. The
header names are normalized so that using <tt class="docutils literal"><span class="pre">Content-Type</span></tt> is equivalent
to <tt class="docutils literal"><span class="pre">content-type</span></tt> or even <tt class="docutils literal"><span class="pre">content_type</span></tt>.</p>
</div>
</div>
<div class="section" id="the-request-object">
<span id="index-14"></span><h2>The Request Object<a class="headerlink" href="#the-request-object" title="Permalink to this headline">¶</a></h2>
<p>Besides the values of the routing placeholders, the controller also has access
to the <tt class="docutils literal"><span class="pre">Request</span></tt> object when extending the base <tt class="docutils literal"><span class="pre">Controller</span></tt> class:</p>
<div class="highlight-python"><pre>$request = $this-&gt;get('request');

$request-&gt;isXmlHttpRequest(); // is it an Ajax request?

$request-&gt;getPreferredLanguage(array('en', 'fr'));

$request-&gt;query-&gt;get('page'); // get a $_GET parameter

$request-&gt;request-&gt;get('page'); // get a $_POST parameter</pre>
</div>
<p>Like the <tt class="docutils literal"><span class="pre">Response</span></tt> object, the request headers are stored in a <tt class="docutils literal"><span class="pre">HeaderBag</span></tt>
object and are easily accessible.</p>
</div>
<div class="section" id="overview">
<span id="index-15"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In Symfony, a controller is nothing more than a PHP function that contains
whatever arbitrary logic is needed to create and return a <tt class="docutils literal"><span class="pre">Response</span></tt> object.
The controller allows us to have an application with many pages while keeping
the logic for each page organized into different controller classes and action
methods.</p>
<p>Symfony2 decides which controller should handle each request by matching
a route and resolving the string format of its <tt class="docutils literal"><span class="pre">_controller</span></tt> parameter
to a real Symfony2 controller. The arguments on that controller correspond
to the parameters on the route, allowing your controller access to the information
form the request.</p>
<p>The controller can do anything and contain any logic, as long as it returns
a <tt class="docutils literal"><span class="pre">Response</span></tt> object. If you extend the base <tt class="docutils literal"><span class="pre">Controller</span></tt> class, you
instantly have access to all of the Symfony2 core service objects as well
as shortcut methods to performing the most common tasks.</p>
</div>
<div class="section" id="learn-more-from-the-cookbook">
<h2>Learn more from the Cookbook<a class="headerlink" href="#learn-more-from-the-cookbook" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/controller/service.html"><em>How to define Controllers as Services</em></a></li>
<li><a class="reference internal" href="../cookbook/controller/error_pages.html"><em>How to customize Error Pages</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The Controller</a><ul>
<li><a class="reference internal" href="#requests-controller-response-lifecycle">Requests, Controller, Response Lifecycle</a></li>
<li><a class="reference internal" href="#a-simple-controller">A Simple Controller</a></li>
<li><a class="reference internal" href="#mapping-a-uri-to-a-controller">Mapping a URI to a Controller</a><ul>
<li><a class="reference internal" href="#route-parameters-as-controller-arguments">Route Parameters as Controller Arguments</a><ul>
<li><a class="reference internal" href="#the-order-of-the-controller-arguments-does-not-matter">The order of the controller arguments does not matter.</a></li>
<li><a class="reference internal" href="#each-required-controller-argument-must-match-up-with-a-routing-parameter">Each required controller argument must match up with a routing parameter.</a></li>
<li><a class="reference internal" href="#not-all-routing-parameters-need-to-be-arguments-on-your-controller">Not all routing parameters need to be arguments on your controller.</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#the-base-controller-class">The Base Controller Class</a></li>
<li><a class="reference internal" href="#common-controller-tasks">Common Controller Tasks</a><ul>
<li><a class="reference internal" href="#redirecting">Redirecting</a></li>
<li><a class="reference internal" href="#forwarding">Forwarding</a></li>
<li><a class="reference internal" href="#rendering-templates">Rendering Templates</a></li>
<li><a class="reference internal" href="#accessing-other-services">Accessing other Services</a></li>
</ul>
</li>
<li><a class="reference internal" href="#managing-errors">Managing Errors</a></li>
<li><a class="reference internal" href="#managing-the-session">Managing the Session</a><ul>
<li><a class="reference internal" href="#flash-messages">Flash Messages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-response-object">The Response Object</a></li>
<li><a class="reference internal" href="#the-request-object">The Request Object</a></li>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#learn-more-from-the-cookbook">Learn more from the Cookbook</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="doctrine/mongodb-odm/configuration.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="routing.html"
                        title="next chapter">Routing</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/controller.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="routing.html" title="Routing"
             >next</a> |</li>
        <li class="right" >
          <a href="doctrine/mongodb-odm/configuration.html" title="Configuration"
             >previous</a> |</li>
        <li><a href="../index.html">symfony-docs-fr v0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Manuel</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>